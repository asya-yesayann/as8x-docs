---
layout: page
title: "CodeGen : 4X նկարագրությունների տեղափոխման մասնակի ավտոմատացում"
tags: CodeGen
---

Բովանդակություն
* [Ներածություն](#ներածություն)
* [Նախապատրաստական քայլեր](#նախապատրաստական-քայլեր)
* [Նկարագրությունը տեղափոխելու համար անհրաժեշտ ընդհանուր քայլեր](#նկարագրությունը-տեղափոխելու-համար-անհրաժեշտ-ընդհանուր-քայլեր)
* [Տվյալների աղբյուրի նկարագրությունը տեղափոխելու համար անհրաժեշտ քայլեր](#տվյալների-աղբյուրի-նկարագրությունը-տեղափոխելու-համար-անհրաժեշտ-քայլեր)
* [Փաստաթղթի նկարագրությունը տեղափոխելու համար անհրաժեշտ քայլեր](#փաստաթղթի-նկարագրությունը-տեղափոխելու-համար-անհրաժեշտ-քայլեր)
  * [Փաստաթղթի սերվերային նկարագրության տեղափոխում](#փաստաթղթի-սերվերային-նկարագրության-տեղափոխում)
  * [Փաստաթղթի կլիենտական նկարագրության տեղափոխում](#փաստաթղթի-կլիենտական-նկարագրության-տեղափոխում)

## Ներածություն

CodeGen գործիքը նախատեսված է 4X-ում նկարագրված տվյալների աղբյուրների և փաստաթղթերի նկարագրությունների 8X համակարգ տեղափոխումը մասնակի ավտոմատացնելու համար։ 
Այն հնարավորություն է տալիս 8X տեղափոխել համակարգային նկարագրությունների միայն նկարագրման հատվածը (Definition), սկրիպտային բաժնի տեղափոխումը ավտոմատացված չէ։  

Codegen-ը աշխատում է Text Template (`.tt` ընդլայնմամբ) ֆայլերի միջոցով և աշխատանքի արդյունքում գեներացնում է `.cs` ընդլայնմամբ ֆայլ։

Փաստաթղթերի դեպքում գեներացվող `.cs` ֆայլում ձևավորվում են դաշտերի (ռեկվիզիտների), աղյուսակների, նկարաների և մեծ տեքստային դաշտերի համապատասխան հատկություններ, ինչպես նաև աղյուսակների տողերի համապատասխան դասեր։  
Տվյալների աղբյուրի դեպքում գեներացվող `.cs` ֆայլում ձևավորվում են մեկ տողի սյուներին համապատասխանող դաս, պարամետրերին համապատասխանող դաս և մետատվյալները ձևավորող կոնստրուկտոր։

## Նախապատրաստական քայլեր

- Տեղադրել [Visual Studio 2022](https://visualstudio.microsoft.com/downloads/)-ը։
- Աշխատացնել 8X-ի պրոյեկտի մեջ `...\AS-8X\bin` թղթապանակի ArmSoft.AS8X.CodeGen.bat Ֆայլը `Run as administrator` հրամանով, որը ռեգիստրացնում է CodeGen գործիքի աշխատանքի համար անհրաժեշտ dll-ները։
- Եթե Visual Studio-ն բաց է, ապա ռեգիստրացիայից հետո հարկավոր է այն փակել և նորից բացել, որպեսզի ռեգիստրացված dll-ները հասանելի դառնան։
- Այն պրոյեկտում, որտեղ կիրառվելու է Codegen-ը, անհրաժեշտ է ավելացնել `CodeGen.xml` անունով ֆայլ՝ գրելով տեղափոխվող սկրիպտերի թղթապանակի հարաբերական ճանապարհը `CodeGen.xml` ֆայլի նկատմամբ։

Օրինակ՝

Եթե պրոյեկտը գտվում է հետևյալ թղթապանակում  
`C:\MyWork\Solution\8XProject\`  
սկրիպտերը գտնվում են հետևյալ թղթապանակում  
`C:\MyWork\Scripts\`  
ապա `CodeGen.xml`-ը կստեղծենք հետևյալ հասցեյում  
`C:\MyWork\Solution\8XProject\CodeGen.xml`  
և պարունակությունը կլինի  
```xml
<?xml version="1.0" encoding="utf-8" ?>
<Configuration>
  <ScriptsPath>..\..\Scripts</ScriptsPath>
</Configuration>
```

## Նկարագրությունը տեղափոխելու համար անհրաժեշտ ընդհանուր քայլեր

 - Ստեղծել Text Template ֆայլ հետևյալ ձևով՝ Add -> New Item -> Text Template։  
   Նախընտրելի է ֆայլի անունը սկսել նկարագրության անունով, ապա գրել `.CodeGen.tt`։  
   Օրինակ՝ `MyDS` տվյալների աղբյուրի համար ֆայլի անունը դնել `MyDS.CodeGen.tt`։  
   Այսպիսի անվանումը օգնում է վերջնական ֆայլերի Visual Studio-ի Solution Explorer-ի մեջ [ներդրվածությունը](https://learn.microsoft.com/en-us/visualstudio/ide/file-nesting-solution-explorer) ապահովելու համար։
 - Ստեղծված ֆայլի հատկությունների `Custom Tool` դաշտի արժեքը պետք է լինի `TextTemplatingFileGenerator`:
 - Ֆայլում ավելացնել հետևյալ տեքստը՝
  
```tt
<#@ template debug="false" hostspecific="true" language="C#" #>
<#@ assembly name="ArmSoft.AS8X.CodeGen" #>
<#@ import namespace="ArmSoft.AS8X.CodeGen" #>
<#@ output extension=".cs" #>
```

Ֆայլի պարունակության մնացած մասը որոշվում է ըստ տեղափոխվող նկարագրության տեսակի։

## Տվյալների աղբյուրի նկարագրությունը տեղափոխելու համար անհրաժեշտ քայլեր

[Ընդհանուր քայլերի](#նկարագրությունը-տեղափոխելու-համար-անհրաժեշտ-ընդհանուր-քայլեր) կատարումից հետո `.tt` ընդլայնմամբ ֆայլում անհրաժեշտ է ավելացնել [DSParser](/src/server_api/DSParser.md) դասի [Parse](/src/server_api/DSParser.md#parse) մեթոդի կանչը, որը գեներացնում է տվյալների աղբյուրի 4X-ական նկարագրությանը համարժեք 8X-ական դասը։ 

Օրինակ՝ 
```tt
<#
string code = DSParser.Parse(
    configFilePath: this.Host.ResolvePath(@"..\..\CodeGen.xml"),
    filename: @"\PAYMENT\DOC\PaySys.as",
    dsName: "OBACSOPT",
    namespaceName: "Bank.BankSettings.DS");
#>
<#= code #>
```

Ֆունկցիային փոխանցվում է 
- `CodeGen.xml` ֆայլի հարաբերական ճանապարհը `.tt` ֆայլի նկատմամբ,
- `.as` ֆայլի հարաբերական ճանապարհը սկրիպտերի թղթապանակում, որը նշված է `CodeGen.xml` ֆայլում։
- Տվյալների աղբյուրի ներքին անունը,
- Ստեղծվող դասի namespace-ի վերջին հատվածը (namespace-ի սկիզբը միշտ `ArmSoft.AS8X.` է)։

## Փաստաթղթի նկարագրությունը տեղափոխելու համար անհրաժեշտ քայլեր

4X համակարգում գոյություն ունի փաստաթուղթի մեկ նկարագրություն:  
8X համակարգում սերվերային և կլիենտական ֆունկցիոնալությունները առանձնացված են և յուրաքանչյուրի համար հարկավոր է սահմանել առանձին դաս։

### Փաստաթղթի սերվերային նկարագրության տեղափոխում

[Ընդհանուր քայլերի](#նկարագրությունը-տեղափոխելու-համար-անհրաժեշտ-ընդհանուր-քայլեր) կատարումից հետո `.tt` ընդլայնմամբ ֆայլում անհրաժեշտ է ավելացնել [DocParser](/src/server_api/DocParser.md) դասի [Parse](/src/server_api/DocParser.md#parse) մեթոդի կանչը, որը գեներացնում է փաստաթղթի 4X-ական նկարագրությանը համարժեք 8X-ական դասը։ 

Օրինակ՝

```tt
<#
string code = DocParser.Parse(
    configFilePath: this.Host.ResolvePath(@"..\..\CodeGen.xml"),
    filename: @"\SOURCE\Agreement\Contracts.as",
    docType: "CnCont",
    namespaceName: "Enterprise.Doc.Agreement");
#>
<#= code #>
```

Ֆունկցիային փոխանցվում է 
- `CodeGen.xml` ֆայլի հարաբերական ճանապարհը `.tt` ֆայլի նկատմամբ,
- `.as` ֆայլի հարաբերական ճանապարհը սկրիպտերի թղթապանակում, որը նշված է `CodeGen.xml` ֆայլում։
- Փաստաթղթի ներքին անունը,
- Ստեղծվող դասի namespace-ի վերջին հատվածը (namespace-ի սկիզբը միշտ `ArmSoft.AS8X.` է)։

### Փաստաթղթի կլիենտական նկարագրության տեղափոխում

[Ընդհանուր քայլերի](#նկարագրությունը-տեղափոխելու-համար-անհրաժեշտ-ընդհանուր-քայլեր) կատարումից հետո `.tt` ընդլայնմամբ ֆայլում անհրաժեշտ է ավելացնել [DocParser](/src/server_api/DocParser.md) դասի [ParseClient](/src/server_api/DocParser.md#parseclient) մեթոդի կանչը, որը գեներացնում է փաստաթղթի 4X-ական նկարագրությանը համարժեք 8X-ական դասը։ 

Օրինակ՝ 
```tt
<#    
string code = DocParser.ParseClient(
    configFilePath: this.Host.ResolvePath(@"..\..\CodeGen.xml"),
    filename: @"\SOURCE\Agreement\Contracts.as",
    docType: "CnCont",
    namespaceName: "Enterprise.Client.Doc.Agreement");   
#>
<#= code #>
```

Ֆունկցիային փոխանցվում է 
- `CodeGen.xml` ֆայլի հարաբերական ճանապարհը `.tt` ֆայլի նկատմամբ,
- `.as` ֆայլի հարաբերական ճանապարհը սկրիպտերի թղթապանակում, որը նշված է `CodeGen.xml` ֆայլում։
- Փաստաթղթի ներքին անունը,
- Ստեղծվող դասի namespace-ի վերջին հատվածը (namespace-ի սկիզբը միշտ `ArmSoft.AS8X.` է)։
